# -*- coding: utf-8 -*-
"""ì‹œê°í™”.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1rIsrVRExb2Y17gBEOYzknxW4F7DPq8Zp
"""


import pandas as pd
import folium
from streamlit_folium import st_folium
import streamlit as st

# í˜ì´ì§€ ì„¤ì •
st.set_page_config(layout="wide")

# ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
df = pd.read_csv("map.csv")
df = df.dropna(subset=['ìœ„ë„', 'ê²½ë„'])

# ì‹œêµ°êµ¬ ì¶”ì¶œ
def extract_city(addr):
    try:
        return addr.split()[1]
    except:
        return None

df['ì‹œêµ°êµ¬'] = df['ì†Œì¬ì§€(ì‚¬ì—…ì¥)'].apply(extract_city)

# ì†Œì¬ì§€ ì„ íƒ
ì†Œì¬ì§€ë“¤ = ['ì „ì²´'] + sorted(df['ì†Œì¬ì§€'].dropna().unique())
ì„ íƒ_ì†Œì¬ì§€ = st.selectbox("ì†Œì¬ì§€ ì„ íƒ", ì†Œì¬ì§€ë“¤)

# ì‹œêµ°êµ¬ í•„í„°
if ì„ íƒ_ì†Œì¬ì§€ == 'ì „ì²´':
    ì„ íƒ_ë°ì´í„° = df.copy()
    ì‹œêµ°êµ¬ = None
else:
    ì„ íƒ_ë°ì´í„° = df[df['ì†Œì¬ì§€'] == ì„ íƒ_ì†Œì¬ì§€]
    ì‹œêµ°êµ¬ë“¤ = sorted(ì„ íƒ_ë°ì´í„°['ì‹œêµ°êµ¬'].dropna().unique())
    ì„ íƒ_ì‹œêµ°êµ¬ = st.selectbox("ì‹œ/êµ°/êµ¬ ì„ íƒ", ì‹œêµ°êµ¬ë“¤)
    ì„ íƒ_ë°ì´í„° = ì„ íƒ_ë°ì´í„°[ì„ íƒ_ë°ì´í„°['ì‹œêµ°êµ¬'] == ì„ íƒ_ì‹œêµ°êµ¬]

# ì§€ë„ ë§Œë“¤ê¸°
center_lat = ì„ íƒ_ë°ì´í„°['ìœ„ë„'].mean()
center_lon = ì„ íƒ_ë°ì´í„°['ê²½ë„'].mean()
m = folium.Map(location=[center_lat, center_lon], zoom_start=6 if ì„ íƒ_ì†Œì¬ì§€ == 'ì „ì²´' else 11)

for _, row in ì„ íƒ_ë°ì´í„°.iterrows():
    folium.Marker(
        location=[row['ìœ„ë„'], row['ê²½ë„']],
        popup=f"{row['ì‚¬ì—…ì¥ëª…']}<br>ì²´ë¶ˆì•¡: {row['ì²´ë¶ˆì•¡(ì›)']}",
        tooltip=row['ì‚¬ì—…ì¥ëª…']
    ).add_to(m)

# ì§€ë„ í‘œì‹œ
st_folium(m, width=1000, height=600)

# í‘œ í‘œì‹œ
st.markdown("### ğŸ“‹ ì‚¬ì—…ì¥ ëª©ë¡")
st.dataframe(ì„ íƒ_ë°ì´í„°[['ì‚¬ì—…ì¥ëª…', 'ì£¼ì†Œì§€(ì‚¬ì—…ì£¼)', 'ì²´ë¶ˆì•¡(ì›)', 'ì†Œì¬ì§€', 'ì‹œêµ°êµ¬']].reset_index(drop=True))
